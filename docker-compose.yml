version: '3.8'

services:
  selenium-hub:
    build:  # ğŸ”¥ ã“ã“ã‚’ä¿®æ­£
      context: .
      dockerfile: Dockerfile.selenium
    container_name: selenium-hub  # ğŸ”¥ åå‰ã‚’çµ±ä¸€
    ports:
      - "4445:4445"  # ğŸ”¥ deploy-jpx-scraper.sh ã«åˆã‚ã›ã‚‹
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4445/status"]
      interval: 10s
      retries: 5
      start_period: 10s
    restart: always  # ğŸ”¥ å†èµ·å‹•æ™‚ã«è‡ªå‹•ã§ç«‹ã¡ä¸ŠãŒã‚‹
    networks:
      - selenium-network

  selenium-node:
    image: selenium/node-chrome
    container_name: selenium-node  # ğŸ”¥ åå‰ã‚’çµ±ä¸€
    depends_on:
      - selenium-hub
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
    restart: always  # ğŸ”¥ å†èµ·å‹•æ™‚ã«è‡ªå‹•ã§ç«‹ã¡ä¸ŠãŒã‚‹
    networks:
      - selenium-network

  scraper:
    build:
      context: .
      dockerfile: Dockerfile.go
    container_name: jpx-scraper  # ğŸ”¥ åå‰ã‚’çµ±ä¸€
    depends_on:
      selenium-hub:
        condition: service_healthy  # ğŸ”¥ Selenium Hub ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãŒé€šã£ã¦ã‹ã‚‰èµ·å‹•
    ports:
      - "8082:8081"
    environment:
      - CGO_ENABLED=1
    restart: always  # ğŸ”¥ å†èµ·å‹•æ™‚ã«è‡ªå‹•ã§ç«‹ã¡ä¸ŠãŒã‚‹
    networks:
      - selenium-network

networks:
  selenium-network:
    driver: bridge

